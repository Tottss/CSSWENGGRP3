{{#> main}}
<div class="profile-container">
    <div class="projects-form-box">
        <h1 class="profile-title">My Profile</h1>

        <!-- SINGLE FORM FOR EVERYTHING (removed method="post") -->
        <form id="profileForm" enctype="multipart/form-data">

            <!-- Hidden file input for main image selection -->
            <input type="file" id="fileInput" name="profileImage" accept="image/*" hidden>

            <!-- Clicking this opens modal -->
            <div class="image-upload-wrapper">
                <img src="{{user.ImageURL}}" class="profile-image-preview" id="profileImage">
                <i class="bi bi-pen-fill edit-icon" id="editIcon"></i>
            </div>

            <!-- IMAGE MODAL -->
            <div id="imageModal" class="image-modal">
                <span class="close">&times;</span>
                <img class="modal-content" id="modalImage">

                <!-- Second file input INSIDE FORM but WITHOUT duplicate ID -->
                <input type="file" name="profileImage" accept="image/*">

                <button type="button" id="changeImageBtn" class="changeImageBtn">
                    Change Image
                </button>
            </div>

            <!-- Other profile input fields -->
            {{> ApplyInputs user=user}}

            <!-- Save Button -->
            <div class="dashboard-header">
              <button type="submit" class="apply-btn">Save Edits</button>
              <button type="submit" class="apply-btn">Change Password</button>
            </div>
            

        </form>
    </div>
</div>
{{/main}}

<script>
const profileImage = document.getElementById('profileImage');
const modal = document.getElementById('imageModal');
const modalImg = document.getElementById('modalImage');
const closeBtn = document.querySelector('.image-modal .close');
const fileInput = document.getElementById('fileInput');
const changeImageBtn = document.getElementById('changeImageBtn');

// Open modal when profile image is clicked
profileImage.addEventListener('click', () => {
  modal.style.display = 'block';
  modalImg.src = profileImage.src;
});

// Close modal
closeBtn.addEventListener('click', () => {
  modal.style.display = 'none';
});

// Close modal when clicking outside image
modal.addEventListener('click', (e) => {
  if (e.target === modal) modal.style.display = 'none';
});

// Trigger image selection from modal button
changeImageBtn.addEventListener('click', (e) => {
  e.preventDefault();
  fileInput.click();
});

// Update preview when new image is selected
fileInput.addEventListener('change', () => {
  const file = fileInput.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      profileImage.src = e.target.result;
      modalImg.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
});
</script>
<script src="/JAVASCRIPT/editProfile.js"></script>
